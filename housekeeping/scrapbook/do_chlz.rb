marks = %(
    M Leo 001	M.c 224	1001139053
    M Leo 001	M.c 224	991014238
    M Leo 001	M.c 224	991014249
    M Leo 002	M.c 225	991014241
    M Leo 003	M.c 226	1001139175
    M Leo 003	M.c 226	991014250
    M Leo 003	M.c 226	991014254
    M Leo 003	M.c 226	990067245
    M Leo 003	M.c 226	402008384
    M Leo 004	M.c 227	1001139194
    M Leo 004	M.c 227	991014254
    M Leo 004	M.c 227	402008317
    M Leo 004	M.c 227	406003360
    M Leo 005	M.c 228	1001140318
    M Leo 005	M.c 228	991014242
    M Leo 005	M.c 228	991014234
    M Leo 005	M.c 228	991014250
    M Leo 005	M.c 228	991014239
    M Leo 005	M.c 228	402008503
    M Leo 006	M.c 229	410006933
    M Leo 007	M.c 230	990015307
    M Leo 008	M.c 231	1001140320
    M Leo 008	M.c 231	990015310
    M Leo 008	M.c 231	990015308
    M Leo 008	M.c 231	990015309
    M Leo 009	M.c 232	990015316
    M Leo 010	M.c 233	990015317
    M Leo 011	M.c 234	1001140321
    M Leo 011	M.c 234	990015320
    M Leo 011	M.c 234	990034697
    M Leo 011	M.c 234	408001181
    M Leo 011	M.c 234	990015318
    M Leo 012	M.c 235	1001140350
    M Leo 012	M.c 235	990015321
    M Leo 012	M.c 235	990036538
    M Leo 012	M.c 235	990015323
    M Leo 013	M.c 236	990015324
    M Leo 014	M.c 237	1001140355
    M Leo 014	M.c 237	990015311
    M Leo 014	M.c 237	990021724
    M Leo 014	M.c 237	990023606
    M Leo 015	M.c 238	408000870
    M Leo 016	M.c 239	1000000600
    M Leo 017	M.c 240	1001140359
    M Leo 017	M.c 240	1000000600
    M Leo 017	M.c 240	991022283
    M Leo 017	M.c 240	991014245
    M Leo 017	M.c 240	990018254
    M Leo 017	M.c 240	991014282
    M Leo 017	M.c 240	402008511
    M Leo 017	M.c 240	406003360
    M Leo 017	M.c 240	406003363
    M Leo 018	M.c 241	1001140368
    M Leo 018	M.c 241	402008576
    M Leo 018	M.c 241	402008578
    M Leo 018	M.c 241	402008580
    M Leo 018	M.c 241	402008582
    M Leo 018	M.c 241	402008584
    M Leo 018	M.c 241	402008586
    M Leo 018	M.c 241	402008708
    M Leo 018	M.c 241	402008709
    M Leo 018	M.c 241	402008710
    M Leo 018	M.c 241	1001141700
    M Leo 018	M.c 241	1001141705
    M Leo 018	M.c 241	1001141708
    M Leo 018	M.c 241	400110189
    M Leo 018	M.c 241	400110190
    M Leo 019	M.c 242	1001140369
    M Leo 019	M.c 242	990020045
    M Leo 019	M.c 242	990053708
    M Leo 019	M.c 242	990053706
    M Leo 020	M.c 243	1001140371
    M Leo 020	M.c 243	990020049
    M Leo 020	M.c 243	990020050
    M Leo 021	M.c 244	1001140372
    M Leo 021	M.c 244	990021725
    M Leo 021	M.c 244	402008384
    M Leo 021	M.c 244	408000896
    M Leo 022	M.c 245	990024413
    M Leo 023	M.c 246	1001140376
    M Leo 023	M.c 246	990026236
    M Leo 023	M.c 246	990033837
    M Leo 023	M.c 246	990033843
    M Leo 024	M.c 247	1001140379
    M Leo 024	M.c 247	990033053
    M Leo 024	M.c 247	990020047
    M Leo 024	M.c 247	990049284
    M Leo 025	M.c 248	1001140380
    M Leo 025	M.c 248	990033056
    M Leo 025	M.c 248	990055233
    M Leo 026	M.c 249	1001140381
    M Leo 026	M.c 249	990033058
    M Leo 026	M.c 249	990033833
    M Leo 027	M.c 250	1001140382
    M Leo 027	M.c 250	402013498
    M Leo 027	M.c 250	406003674
    M Leo 027	M.c 250	408001166
    M Leo 028	M.c 251	990033830
    M Leo 029	M.c 252	1001140400
    M Leo 029	M.c 252	990033835
    M Leo 029	M.c 252	990015303
    M Leo 030	M.c 253	1001140403
    M Leo 030	M.c 253	990033838
    M Leo 030	M.c 253	990034052
    M Leo 030	M.c 253	990046224
    M Leo 030	M.c 253	990037135
    M Leo 031	M.c 254	990033839
    M Leo 032	M.c 255	1001140405
    M Leo 032	M.c 255	990033840
    M Leo 032	M.c 255	990033841
    M Leo 033	M.c 256	1001140407
    M Leo 033	M.c 256	990033842
    M Leo 033	M.c 256	990033821
    M Leo 034	M.c 257	990034050
    M Leo 035	M.c 258	1001140408
    M Leo 35	M.c 258	990034051
    M Leo 035	M.c 258	990060435
    M Leo 035	M.c 258	990064790
    M Leo 035	M.c 258	990069808
    M Leo 036	M.c 259	1001142038
    M Leo 36	M.c 259	990034055
    M Leo 036	M.c 259	990033054
    M Leo 036	M.c 259	990034056
    M Leo 037	M.c 260	1001142506
    M Leo 037	M.c 260	990034063
    M Leo 037	M.c 260	990058546
    M Leo 038	M.c 261	1001142515
    M Leo 038	M.c 261	990034064
    M Leo 038	M.c 261	990058545
    M Leo 038	M.c 261	990068299
    M Leo 039	M.c 262	1001142518
    M Leo 039	M.c 262	990034071
    M Leo 039	M.c 262	990033832
    M Leo 040	M.c 263	1001142520
    M Leo 040	M.c 263	990034716
    M Leo 040	M.c 263	990014809
    M Leo 041	M.c 264	1001142826
    M Leo 041	M.c 264	990036536
    M Leo 041	M.c 264	990058552
    M Leo 041	M.c 264	990015315
    M Leo 041	M.c 264	990015316
    M Leo 041	M.c 264	990048645
    M Leo 041	M.c 264	990015314
    M Leo 042	M.c 265	1001143188
    M Leo 042	M.c 265	990037138
    M Leo 042	M.c 265	990037134
    M Leo 042	M.c 265	990036870
    M Leo 043	M.c 266	990046435
    M Leo 044	M.c 267	1001143365
    M Leo 044	M.c 267	990041209
    M Leo 044	M.c 267	990041211
    M Leo 044	M.c 267	990034067
    M Leo 044	M.c 267	990034068
    M Leo 045	M.c 268	1001143441
    M Leo 045	M.c 268	990041209
    M Leo 045	M.c 268	990041210
    M Leo 045	M.c 268	990041208
    M Leo 045	M.c 268	990041211
    M Leo 046	M.c 269	1001143444
    M Leo 046	M.c 269	402008881
    M Leo 046	M.c 269	1001143452
    M Leo 046	M.c 269	1001143479
    M Leo 046	M.c 269	1001143483
    M Leo 046	M.c 269	400111122
    M Leo 046	M.c 269	1001053151
    M Leo 046	M.c 269	410007664
    M Leo 046	M.c 269	402008713
    M Leo 047	M.c 270	1001143504
    M Leo 047	M.c 270	990048646
    M Leo 047	M.c 270	408001232
    M Leo 047	M.c 270	990015319
    M Leo 048	M.c 271	1001143842
    M Leo 048	M.c 271	990048643
    M Leo 048	M.c 271	990015306
    M Leo 048	M.c 271	990033846
    M Leo 049	M.c 272	990048647
    M Leo 050	M.c 273	1001143847
    M Leo 050	M.c 273	990049849
    M Leo 050	M.c 273	990025975
    M Leo 051	M.c 274	1001143849
    M Leo 051	M.c 274	990052383
    M Leo 051	M.c 274	990033820
    M Leo 051	M.c 274	991020138
    M Leo 052	M.c 275	990053694
    M Leo 053	M.c 276	990053698
    M Leo 054	M.c 277	990053699
    M Leo 055	M.c 278	990053701
    M Leo 056	M.c 279	990053703
    M Leo 057	M.c 280	990053704
    M Leo 058	M.c 281	1001143873
    M Leo 058	M.c 281	990055237
    M Leo 058	M.c 281	990033819
    M Leo 058	M.c 281	990033057
    M Leo 058	M.c 281	990053709
    M Leo 059	M.c 282	1001143879
    M Leo 059	M.c 282	990047495
    M Leo 059	M.c 282	990069807
    M Leo 060	M.c 283	410007921
    M Leo 061	M.c 284	1001144018
    M Leo 061	M.c 284	408000056
    M Leo 061	M.c 284	408000057
    M Leo 061	M.c 284	408000058
    M Leo 061	M.c 284	408000059
    M Leo 061	M.c 284	408000060
    M Leo 061	M.c 284	408000061
    M Leo 062	M.c 285	1001144021
    M Leo 062	M.c 285	402009043
    M Leo 062	M.c 285	1001144025
    M Leo 062	M.c 285	1001144026
    M Lei 062	M.c 285	400111269
    M Leo 063	M.c 286	1001144054
    M Leo 063	M.c 286	990058330
    M Leo 063	M.c 286	990029800
    M Leo 063	M.c 286	990053707
    M Leo 064	M.c 287	1001144873
    M Leo 064	M.c 287	990058556
    M Leo 064	M.c 287	990038874
    M Leo 064	M.c 287	990002087
    M Leo 065	M.c 288	1001144880
    M Leo 065	M.c 288	990058557
    M Leo 065	M.c 288	990052386
    M Leo 066	M.c 289	1001144882
    M Leo 066	M.c 289	990058555
    M Leo 066	M.c 289	990033831
    M Leo 067	M.c 290	1001144886
    M Leo 067	M.c 290	991014244
    M Leo 067	M.c 290	991014256
    M Leo 068	M.c 291	992000253
    M Leo 069	M.c 292	990067360
)

marks.each_line do |l|
    found = false
    p = l.strip.split("\t")
    next if p.empty?
    s = Source.find(p[2])

    if s.record_type != 8
        m = s.marc
        if m.first_occurance("852", "c") 
            shelfmark = m.first_occurance("852", "c").content
            if p[0].strip.downcase == shelfmark.strip.downcase
                puts "#{s.id}\tn.a.\t#{p[0]}\t#{p[1]}"
                m.first_occurance("852", "c").content = p[1]
                s.save
                found = true
            end
        end
    else
        s.holdings.each do |h|
            next if !h.lib_siglum == "CH-Lz"
            h.marc.load_source true
            m = h.marc
            shelfmark = m.first_occurance("852", "c").content
            if p[0].strip.downcase == shelfmark.strip.downcase
                puts "#{s.id}\t#{h.id}\t#{p[0]}\t#{p[1]}"
                m.first_occurance("852", "c").content = p[1]
                h.save
                found = true
            end
        end
    end
    #ap l if !found
end

=begin
hop = {}
marks.each_line do |l|
    p = l.strip.split("\t")
    hop[p[0]] = p[1]
end

Source.where(record_type: 11).each do |s|

    next if !s.siglum_matches?("CH-Lz")
    #puts "#{s.id}"

    m = s.marc
    if m.first_occurance("852", "c") 
        shelfmark = m.first_occurance("852", "c").content
        if hop.keys.include? shelfmark
            puts "#{s.id}\t#{s.id}\t#{shelfmark}\t#{hop[shelfmark]}"
            m.first_occurance("852", "c").content = hop[shelfmark]
        end
    end
end

pipino

Source.where(record_type: 8).each do |s|

    next if !s.siglum_matches?("CH-Lz")

    s.holdings.each do |h|
        next if !h.lib_siglum == "CH-Lz"
        h.marc.load_source true
        m = h.marc
        shelfmark = m.first_occurance("852", "c").content
        if hop.keys.include? shelfmark
            puts "#{s.id}\t#{h.id}\t#{shelfmark}\t#{hop[shelfmark]}"
            m.first_occurance("852", "c").content = hop[shelfmark]
            h.save
        end
    end

end
=end